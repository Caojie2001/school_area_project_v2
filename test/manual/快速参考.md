# 测试数据改造快速参考

## 一条命令运行

```bash
# 确保在项目根目录下
nvm use 22 && node scripts/transform_test_data.js
```

## 输入输出

| 项目 | 路径 |
|-----|------|
| 输入 | `test/manual/高校测算_测试数据0821.xlsx` |
| 输出 | `test/manual/高校测算_测试数据_v2.3.0.xlsx` |

## 数据映射关系

### 学生数据拆分

```
全日制学生总数 → 本科生(70%) + 专科生(20%) + 硕士生(8%) + 博士生(2%)
留学生总数     → 本科生(60%) + 硕士生(30%) + 博士生(10%)
```

### 面积数据拆分（所有用房类型）

```
汇总面积 → 现状(60%) + 拟建成前期(20%) + 拟建成在建(20%)
```

适用于：
- 教学及辅助用房
- 办公用房  
- 生活配套用房
- 学生宿舍
- 其他生活用房
- 后勤辅助用房
- 建筑总面积

## 生成的6个工作表

| # | 工作表名称 | 用途 |
|---|-----------|------|
| 1 | 学校基础信息 | 学校基本信息 |
| 2 | 学生数据明细 | 拆分后的学生人数 |
| 3 | 建筑面积数据_三阶段 | 三阶段面积数据 |
| 4 | **综合测试数据** | **完整数据，推荐测试用** ⭐ |
| 5 | 测试场景说明 | 8个测试场景 |
| 6 | 字段说明 | 所有字段说明 |

## 与数据库字段对应

### 学生数据 → calculation_history

```javascript
全日制本科生 → full_time_undergraduate
全日制专科生 → full_time_specialist
全日制硕士生 → full_time_master
全日制博士生 → full_time_doctor
留学生本科生 → international_undergraduate
留学生硕士生 → international_master
留学生博士生 → international_doctor
```

### 面积数据 → calculation_history

```javascript
教学及辅助用房_现状         → teaching_area_current
教学及辅助用房_拟建成前期   → teaching_area_preliminary
教学及辅助用房_拟建成在建   → teaching_area_under_construction
教学及辅助用房_汇总         → teaching_area_total
```

类似模式适用于：
- `office_area_*` (办公用房)
- `total_living_area_*` (生活配套用房)
- `dormitory_area_*` (学生宿舍)
- `other_living_area_*` (其他生活用房)
- `logistics_area_*` (后勤辅助用房)
- `*_building_area` (建筑总面积)

## 8个测试场景

| 场景 | 名称 | 重点 |
|-----|------|------|
| T01 | 基础功能测试 | 标准配置 |
| T02 | 大规模学校 | 10000+人 |
| T03 | 小规模学校 | 500-1000人 |
| T04 | 三阶段面积 | 现状+前期+在建 |
| T05 | 留学生比例 | 留学生影响 |
| T06 | 边界值 | 极端数据 |
| T07 | 特殊补助 | 补助计算 |
| T08 | 院校类型 | 10种类型对比 |

## 快速测试流程

1. 运行脚本生成测试数据
2. 打开 `高校测算_测试数据_v2.3.0.xlsx`
3. 切换到 **综合测试数据** 工作表
4. 选择一条数据
5. 复制到系统进行测试
6. 对照 `docs/MANUAL_TEST_CASES.md` 执行测试用例

## 调整拆分比例

编辑 `scripts/transform_test_data.js`，修改以下数值：

```javascript
// 学生数据拆分比例
const fullTimeUndergrad = Math.floor(fullTimeTotal * 0.7);   // 本科 70%
const fullTimeSpecialist = Math.floor(fullTimeTotal * 0.2);  // 专科 20%
const fullTimeMaster = Math.floor(fullTimeTotal * 0.08);     // 硕士 8%
const fullTimeDoctor = Math.floor(fullTimeTotal * 0.02);     // 博士 2%

// 面积数据拆分比例
const currentArea = Math.floor(totalArea * 0.6);             // 现状 60%
const preliminaryArea = Math.floor(totalArea * 0.2);         // 前期 20%
const underConstructionArea = totalArea - currentArea - preliminaryArea; // 在建 20%
```

## 常见问题

**Q: 为什么拆分后的数据总和与原始数据略有差异？**
A: 因为使用了 `Math.floor()` 向下取整，差异通常小于原始值的1%。

**Q: 可以修改拆分比例吗？**
A: 可以，修改脚本中的比例常数后重新运行即可。

**Q: 原始文件会被修改吗？**
A: 不会，脚本只读取原始文件，生成新的输出文件。

**Q: 如何验证拆分是否正确？**
A: 每个工作表都保留了汇总列，对比即可验证。

## 相关文档

- 详细说明：`test/manual/README_测试数据改造.md`
- 结构对比：`test/manual/数据结构对比.txt`
- 测试用例：`docs/MANUAL_TEST_CASES.md`
